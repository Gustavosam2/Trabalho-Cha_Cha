<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Tiger vs Bear</title>
  <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
    canvas { display: block; }

    /* Estilos do Menu e Vitória */
    #menuInicial, #telaVitoria {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      user-select: none;
      z-index: 9999;
    }

    #menuInicial { background: orange; color: #000; }
    
    #telaVitoria {
      display: none;
      background: rgba(0, 0, 0, 0.8);
      color: white;
    }

    #menuInicial img, #telaVitoria img {
      width: 300px;
      height: auto;
      margin-bottom: 20px;
      image-rendering: pixelated;
      border: 3px solid black;
    }

    #menuInicial h1, #telaVitoria h1, #mensagemVitoria {
      font-family: 'Bangers', cursive;
      font-weight: normal;
    }

    #menuInicial h1 { font-size: 4vw; margin-bottom: 40px; text-shadow: 2px 2px 4px #444; }
    #telaVitoria h1 { font-size: 5vw; color: #ffd700; text-shadow: 3px 3px 6px #000; margin-bottom: 40px; }

    #botaoJogar, #botaoReiniciar {
      font-size: 2.5vw;
      padding: 15px 40px;
      background: #ffd700;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 2px 2px 6px #888;
      transition: background 0.3s ease;
      font-family: 'Bangers', cursive;
    }

    #botaoJogar:hover, #botaoReiniciar:hover { background: #ffea00; }
  </style>
</head>
<body>

  <div id="menuInicial">
    <img src="tigre-vs-urso.png" alt="Tiger vs Bear Logo" />
    <h1>Tiger vs Bear</h1>
    <button id="botaoJogar" onclick="iniciarJogo()">Jogar</button>
  </div>
  
  <div id="telaVitoria">
    <img id="vencedorImagem" src="" alt="Vencedor" />
    <h1 id="mensagemVitoria"></h1>
    <button id="botaoReiniciar" onclick="location.reload()">Jogar Novamente</button>
  </div>

  <script>
    /* ==========================
       Variáveis principais (Originais)
       ========================== */
    let jogadores = [];
    let bola;
    let gravidade;
    let alturaDoChao;
    let raioDaBola;
    let teclas = {};
    let placar = [0, 0];
    let tamanhoDoJogador;
    let puloDoJogador;
    let velocidadeDoJogador;
    let alturaDaCesta;
    let larguraDaCesta;
    let espessuraDaCesta;

    let bolaNaAreaCestaEsq = false;
    let bolaNaAreaCestaDir = false;
    let jogoIniciado = false; // Começa falso para o menu
    let jogoAcabou = false;

    /* Sprites */
    let tigerSprite, tigerWalkRightSprite, tigerJumpSprite, tigerPushSprite;
    let bearSprite, bearWalkRightSprite, bearJumpSprite, bearPushSprite;
    let chaoEcestas, fundoPlateiaCestas;
    let bolaSprite;

    let podeEmpurrarTiger = true;
    let podeEmpurrarBear = true;
    let tigerEmpurrando = false;
    let bearEmpurrando = false;
    let tempoEmpurrando = 0;

    function preload() {
      tigerSprite = loadImage("tiger_idle.png");
      tigerWalkRightSprite = loadImage("tiger_walk.png");
      tigerJumpSprite = loadImage("tiger_jump.png");
      tigerPushSprite = loadImage("tiger_push.png");
      bearSprite = loadImage("bear_idle.png");
      bearWalkRightSprite = loadImage("bear_walk.png");
      bearJumpSprite = loadImage("bear_jump.png");
      bearPushSprite = loadImage("bear_push.png");
      chaoEcestas = loadImage("chaoEcestas.png");
      fundoPlateiaCestas = loadImage("fundoPlateiaCestas.png");
      bolaSprite = loadImage("bola_basquete.png");
    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
      recalcularMedidas();
      inicializarJogo();
      noLoop(); // Trava o jogo até o clique no botão
    }

    // Função para o botão do Menu
    function iniciarJogo() {
      document.getElementById('menuInicial').style.display = 'none';
      jogoIniciado = true;
      loop();
    }

    function recalcularMedidas() {
      gravidade = height * 0.0055;
      raioDaBola = height * 0.05;
      tamanhoDoJogador = height * 0.18;
      puloDoJogador = height * 0.075;
      velocidadeDoJogador = width * 0.012;
      alturaDoChao = height * 0.85;
      alturaDaCesta = height * 0.25;
      larguraDaCesta = width * 0.02;
      espessuraDaCesta = height * 0.13;
    }

    function inicializarJogo() {
      jogadores = [];
      jogadores.push(new Jogador(width * 0.1, alturaDoChao, color(255, 100, 100), "W", "A", "D"));
      jogadores.push(new Jogador(width * 0.9, alturaDoChao, color(100, 100, 255), "ArrowUp", "ArrowLeft", "ArrowRight"));
      bola = new Bola(width / 2);
      podeEmpurrarTiger = true;
      podeEmpurrarBear = true;
      tigerEmpurrando = false;
      bearEmpurrando = false;
    }

    function draw() {
      image(chaoEcestas, 0, alturaDoChao, width, height - alturaDoChao);
      image(fundoPlateiaCestas, 0, 0, width, alturaDoChao);

      if (!jogoIniciado || jogoAcabou) return;

      // Placar
      fill(0);
      textFont('Bangers');
      textSize(height * 0.04);
      textAlign(CENTER, TOP);
      text(`${placar[0]}   |   ${placar[1]}`, width / 2, 10);

      // Instruções
      fill(255);
      textSize(16);
      textAlign(LEFT, TOP);
      text("Tiger: W pula | J empurra", 20, 20);
      text("Bear: ↑ pula | 0 empurra", 20, 50);

      if (!podeEmpurrarTiger) { fill(255, 200, 0); text("J (cooldown)", 20, 80); }
      if (!podeEmpurrarBear) { fill(255, 200, 0); text("0 (cooldown)", 20, 100); }

      for (let j of jogadores) {
        j.atualizar();
        j.mostrar();
      }

      bola.atualizar();
      bola.verificarColisao();
      bola.mostrar();
      verificarPlacar();

      // Colisão entre jogadores
      for (let i = 0; i < jogadores.length; i++) {
        for (let k = i + 1; k < jogadores.length; k++) {
          let a = jogadores[i];
          let b = jogadores[k];
          let dx = b.x - a.x;
          let dy = b.y - a.y;
          let distAB = dist(a.x, a.y, b.x, b.y);
          let minDist = a.raio + b.raio;
          if (distAB < minDist) {
            let overlap = (minDist - distAB) / 2;
            let angle = atan2(dy, dx);
            a.x -= cos(angle) * overlap;
            a.y -= sin(angle) * overlap;
            b.x += cos(angle) * overlap;
            b.y += sin(angle) * overlap;
          }
        }
      }

      if (tigerEmpurrando && millis() > tempoEmpurrando) tigerEmpurrando = false;
      if (bearEmpurrando && millis() > tempoEmpurrando) bearEmpurrando = false;
    }

    class Jogador {
      constructor(x, peNoChaoY, cor, teclaCima, teclaEsquerda, teclaDireita) {
        this.raio = tamanhoDoJogador * 0.5;
        this.alturaSprite = tamanhoDoJogador * 1.5;
        this.x = x;
        this.peNoChaoY = peNoChaoY;
        this.y = peNoChaoY - this.alturaSprite * 0.85;
        this.vx = 0;
        this.vy = 0;
        this.cor = cor;
        this.noChao = true;
        this.teclaCima = teclaCima.toUpperCase();
        this.teclaEsquerda = teclaEsquerda.toUpperCase();
        this.teclaDireita = teclaDireita.toUpperCase();
        this.direction = 1;
        this.isTiger = cor.toString() === color(255, 100, 100).toString();
      }

      atualizar() {
        this.vy += gravidade;
        this.y += this.vy;
        if (teclas[this.teclaEsquerda]) { this.x -= velocidadeDoJogador; this.direction = -1; }
        if (teclas[this.teclaDireita]) { this.x += velocidadeDoJogador; this.direction = 1; }
        if (this.y + this.alturaSprite * 0.85 >= alturaDoChao) {
          this.y = alturaDoChao - this.alturaSprite * 0.85;
          this.vy = 0;
          this.noChao = true;
        } else {
          this.noChao = false;
        }
        this.x = constrain(this.x, this.raio, width - this.raio);
      }

      mostrar() {
        push();
        translate(this.x, this.y);
        scale(this.direction, 1);
        imageMode(CORNER);
        let spriteWidth = this.raio * 2;
        let spriteHeight = this.alturaSprite;
        let spriteOffsetY = 0;

        if (this.isTiger) {
          if (tigerEmpurrando) image(tigerPushSprite, -spriteWidth/2, 0, spriteWidth, spriteHeight);
          else if (!this.noChao) image(tigerJumpSprite, -spriteWidth/2, 0, spriteWidth, spriteHeight);
          else if (teclas[this.teclaEsquerda] || teclas[this.teclaDireita]) image(tigerWalkRightSprite, -spriteWidth/2, 10, spriteWidth, spriteHeight);
          else image(tigerSprite, -spriteWidth/2, 0, spriteWidth, spriteHeight);
        } else {
          spriteHeight = this.alturaSprite * 1.06;
          if (bearEmpurrando) image(bearPushSprite, -spriteWidth/2, -7, spriteWidth, spriteHeight);
          else if (!this.noChao) image(bearJumpSprite, -spriteWidth/2, -7, spriteWidth, spriteHeight);
          else if (teclas[this.teclaEsquerda] || teclas[this.teclaDireita]) image(bearWalkRightSprite, -spriteWidth/2, -12, spriteWidth, this.alturaSprite * 1.12);
          else image(bearSprite, -spriteWidth/2, -7, spriteWidth, spriteHeight);
        }
        pop();
      }
    }

    class Bola {
      constructor(x) {
        this.x = x;
        this.raio = raioDaBola;
        this.vx = random([-1, 1]) * velocidadeDoJogador * 0.005;
        this.vy = 0;
        this.spriteOffsetY = 8;
        this.y = alturaDoChao - this.raio + this.spriteOffsetY;
        this.grudada = false;
        this.jogadorDono = null;
        this.podeGrudar = true;
      }

      atualizar() {
        if (this.grudada && this.jogadorDono) {
          let centroJogadorY = this.jogadorDono.y + this.jogadorDono.alturaSprite * 0.5;
          this.x = this.jogadorDono.x;
          this.y = centroJogadorY - 30;
          this.vx = 0; this.vy = 0;
          return;
        }
        this.vy += gravidade;
        this.x += this.vx;
        this.y += this.vy;
        if (this.y + this.raio > alturaDoChao + this.spriteOffsetY) {
          this.y = alturaDoChao - this.raio + this.spriteOffsetY;
          this.vy *= -0.75;
          this.vx *= 0.9;
        }
        if (this.x - this.raio < 0) { this.x = this.raio; this.vx *= -0.8; }
        if (this.x + this.raio > width) { this.x = width - this.raio; this.vx *= -0.8; }
        if (this.y - this.raio < 0) { this.y = this.raio; this.vy *= -0.6; }
      }

      verificarColisao() {
        if (!this.podeGrudar) return;
        for (let j of jogadores) {
          let centroJogadorY = j.y + j.alturaSprite * 0.5;
          let dx = this.x - j.x;
          let dy = (this.y - this.spriteOffsetY) - centroJogadorY;
          let distancia = dist(j.x, centroJogadorY, this.x, this.y - this.spriteOffsetY);
          let distanciaMinima = this.raio + j.raio * 0.8;
          if (distancia < distanciaMinima) {
            if (!this.grudada && j.noChao) {
              this.grudada = true;
              this.jogadorDono = j;
              return;
            }
            if (!this.grudada) {
              let nx = dx / distancia; let ny = dy / distancia;
              let overlap = distanciaMinima - distancia;
              this.x += nx * overlap;
              this.y += ny * overlap + this.spriteOffsetY;
              let dot = this.vx * nx + this.vy * ny;
              this.vx -= 2 * dot * nx; this.vy -= 2 * dot * ny;
              this.vx *= 1.1; this.vy *= 1.1;
            }
          }
        }
      }

      mostrar() {
        push();
        translate(this.x, this.y + this.spriteOffsetY);
        if (!this.grudada) rotate(atan2(this.vy, this.vx));
        imageMode(CENTER);
        if (bolaSprite) image(bolaSprite, 0, 0, this.raio * 2, this.raio * 2);
        pop();
      }

      soltar() {
        this.grudada = false; this.jogadorDono = null; this.podeGrudar = false;
        setTimeout(() => { this.podeGrudar = true; }, 200);
      }
    }

    window.keyPressed = function() {
      if (!jogoIniciado || jogoAcabou) return;
      teclas[key.toUpperCase()] = true;
      const tiger = jogadores[0]; const bear = jogadores[1];
      const dJogadores = dist(tiger.x, tiger.y, bear.x, bear.y);
      const alcance = (tiger.raio + bear.raio) * 1.8;

      if ((key === 'j' || key === 'J') && podeEmpurrarTiger) {
        if (dJogadores < alcance) {
          bear.x += velocidadeDoJogador * 3.0;
          if (bola.grudada && bola.jogadorDono === bear) {
            bola.soltar(); bola.vx = tiger.direction * velocidadeDoJogador; bola.vy = -puloDoJogador * 0.9;
          }
          tigerEmpurrando = true; tempoEmpurrando = millis() + 300;
          podeEmpurrarTiger = false; setTimeout(() => { podeEmpurrarTiger = true; }, 3000);
        }
      }

      if (key === '0' && podeEmpurrarBear) {
        if (dJogadores < alcance) {
          tiger.x -= velocidadeDoJogador * 3.0;
          if (bola.grudada && bola.jogadorDono === tiger) {
            bola.soltar(); bola.vx = bear.direction * velocidadeDoJogador; bola.vy = -puloDoJogador * 0.9;
          }
          bearEmpurrando = true; tempoEmpurrando = millis() + 300;
          podeEmpurrarBear = false; setTimeout(() => { podeEmpurrarBear = true; }, 3000);
        }
      }

      for (let j of jogadores) {
        if (key.toUpperCase() === j.teclaCima && j.noChao) {
          j.vy = -puloDoJogador * 1.1; j.noChao = false;
          if (bola.grudada && bola.jogadorDono === j) {
            bola.soltar(); bola.vx = j.direction * velocidadeDoJogador * 1.6; bola.vy = -puloDoJogador * 1.0;
          }
        }
      }
    };

    window.keyReleased = function() { if (key) teclas[key.toUpperCase()] = false; };

    function verificarPlacar() {
      if (placar[0] >= 15 || placar[1] >= 15) { fimDeJogo(); return; }
      if (bola.grudada) return;
      const abrEsqMinX = larguraDaCesta; const abrEsqMaxX = espessuraDaCesta - larguraDaCesta;
      const abrEsqY = alturaDaCesta + espessuraDaCesta - larguraDaCesta;
      const abrDirMinX = width - espessuraDaCesta + larguraDaCesta; const abrDirMaxX = width - larguraDaCesta;
      const abrDirY = alturaDaCesta + espessuraDaCesta - larguraDaCesta;

      if (bola.x > abrEsqMinX && bola.x < abrEsqMaxX && bola.y > alturaDaCesta && bola.y < abrEsqY) bolaNaAreaCestaEsq = true;
      if (bolaNaAreaCestaEsq && bola.y > abrEsqY) { placar[1]++; reiniciarJogo(); bolaNaAreaCestaEsq = false; }
      if (bola.x > abrDirMinX && bola.x < abrDirMaxX && bola.y > alturaDaCesta && bola.y < abrDirY) bolaNaAreaCestaDir = true;
      if (bolaNaAreaCestaDir && bola.y > abrDirY) { placar[0]++; reiniciarJogo(); bolaNaAreaCestaDir = false; }
    }

    function fimDeJogo() {
      jogoAcabou = true; noLoop();
      const vencedor = placar[0] >= 15 ? 0 : 1;
      document.getElementById('mensagemVitoria').textContent = vencedor === 0 ? "Quer melzinho, meu felpudinho?" : "Volta pro seu Sucrilhos, gatinho!";
      document.getElementById('vencedorImagem').src = vencedor === 0 ? "tigre-vencendo.png" : "urso-vencendo.png";
      document.getElementById('telaVitoria').style.display = 'flex';
    }

    function reiniciarJogo() {
      bola = new Bola(width / 2);
      jogadores[0].x = width * 0.1; jogadores[0].y = alturaDoChao - jogadores[0].alturaSprite * 0.85; jogadores[0].vy = 0;
      jogadores[1].x = width * 0.9; jogadores[1].y = alturaDoChao - jogadores[1].alturaSprite * 0.85; jogadores[1].vy = 0;
      podeEmpurrarTiger = true; podeEmpurrarBear = true;
      tigerEmpurrando = false; bearEmpurrando = false;
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      recalcularMedidas();
      reiniciarJogo();
      if(jogoIniciado && !jogoAcabou) loop();
    }
  </script>
</body>
</html>
